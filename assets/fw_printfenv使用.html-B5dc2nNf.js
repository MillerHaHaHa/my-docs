import{_ as i,r as l,o,c as r,a as e,b as t,d as a,e as c}from"./app-CmOngkEL.js";const s={},d=c(`<h1 id="fw-printfenv-使用" tabindex="-1"><a class="header-anchor" href="#fw-printfenv-使用"><span>fw_printfenv 使用</span></a></h1><h2 id="一、编译" tabindex="-1"><a class="header-anchor" href="#一、编译"><span>一、编译</span></a></h2><p>先编译一遍 SDK</p><p>然后进入 <code>out/xm72020300/boot_builddir</code> 目录</p><p>编译 fw_printfenv 源码 <code>make ARCH=arm CROSS_COMPILE=arm-gcc7.3-linux-musleabi- envtools</code></p><h2 id="二、内核配置" tabindex="-1"><a class="header-anchor" href="#二、内核配置"><span>二、内核配置</span></a></h2><p>在使用 fw_printfenv 时遇到错误 <code>Error locking file /var/lock/fw_printfenv.lock</code></p><p>内核可能默认不配置 POSIX 标准文件锁定 API，所以程序执行到文件加锁与解锁的 flock() 时失败</p><p>在内核 menuconfig 中搜索 <code>CONFIG_FILE_LOCKING</code>，打卡如下配置，重新编译内核</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>[*] Enable POSIX file locking API
[*]   Enable Mandatory file locking (NEW)
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="三、修改配置文件" tabindex="-1"><a class="header-anchor" href="#三、修改配置文件"><span>三、修改配置文件</span></a></h2><p>fw_env.config 文件用于配置 fw_printfenv 工具指向的环境变量分区。</p><p>以 xm72020300 为例，在 fw_env.config 文件注释掉其他行，新增以下配置：</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code># NOR example
# MTD device name       Device offset   Env. size       Flash sector size       Number of sectors
/dev/mtd1               0x0000          0x10000         0x20000                 1
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol><li>MTD device name 通过 <code>cat /proc/mtd</code>，确认 bootargs 分区名为 mtd1</li><li>Device offset 为相对于 MTD device name 指定的分区的偏移，因为整个分区是单独的环境变量分区，因此是 0x0000</li><li>Env. size 查看 uboot 源码目录下的 <code>configs/xm72020300_quickstart_defconfig</code> 文件中的宏定义 <code>CONFIG_ENV_SIZE=0x10000</code></li><li>Flash sector 查看 uboot 源码目录下的 <code>include/configs/xm72020300.h</code> 文件中的宏定义 <code>#define CONFIG_ENV_OFFSET 0x20000</code> 和 <code>configs/xm72020300_quickstart_defconfig</code> 文件中的宏定义 <code>CONFIG_ENV_OFFSET=0x20000</code></li><li>Number of sectors 根据实际情况，一般为 1</li></ol><h2 id="四、使用" tabindex="-1"><a class="header-anchor" href="#四、使用"><span>四、使用</span></a></h2><p>将编译后的 fw_printfenv 执行程序拷贝到板端，fw_env.config 文件拷贝到板端 <code>/etc</code> 目录下</p><p><strong>必要</strong>，创建 fw_setenv 软链接，<code>ln -s fw_printfenv fw_setenv </code></p><p><code>fw_printfenv -h</code> 查看帮助</p><p><code>fw_printfenv </code> 相当于 printenv，打印环境变量信息</p><p><code>fw_setenv $变量 $值</code> 相当于 setenv+saveenv，设置和保存环境变量信息</p><h2 id="五、通过代码使用" tabindex="-1"><a class="header-anchor" href="#五、通过代码使用"><span>五、通过代码使用</span></a></h2><p>链接 lib.a 库，参考 fw_env_main.c 实现</p><h2 id="六、常见问题" tabindex="-1"><a class="header-anchor" href="#六、常见问题"><span>六、常见问题</span></a></h2><ol><li>如果内核打开了 POSIX 标准文件锁定 API 配置后仍然遇到 <code>Error locking file /var/lock/fw_printfenv.lock</code> ，检查该目录的文件系统是否为只读</li></ol><h2 id="七、参考链接" tabindex="-1"><a class="header-anchor" href="#七、参考链接"><span>七、参考链接</span></a></h2>`,26),p={href:"https://blog.csdn.net/m0_37383484/article/details/129561114?spm=1001.2101.3001.6650.5&utm_medium=distribute.pc_relevant.none-task-blog-2~default~CTRLIST~Rate-5-129561114-blog-124358700.235%5Ev38%5Epc_relevant_anti_vip_base&depth_1-utm_source=distribute.pc_relevant.none-task-blog-2~default~CTRLIST~Rate-5-129561114-blog-124358700.235%5Ev38%5Epc_relevant_anti_vip_base&utm_relevant_index=8",target:"_blank",rel:"noopener noreferrer"},f={href:"https://bbs.aw-ol.com/topic/2923/fw_printfenv%E4%B8%8D%E5%8F%AF%E7%94%A8-error-locking-file-var-lock-fw_printenv-lock",target:"_blank",rel:"noopener noreferrer"},_={href:"https://blog.csdn.net/xl19862005/article/details/118342662",target:"_blank",rel:"noopener noreferrer"};function v(h,m){const n=l("ExternalLinkIcon");return o(),r("div",null,[d,e("p",null,[e("a",p,[t("海思 fw_printenv 和 fw_setenv 工具详解_积步千里的博客-CSDN博客"),a(n)])]),e("p",null,[e("a",f,[t("fw_printfenv不可用(Error locking file /var/lock/fw_printenv.lock) | 全志在线开发者论坛 (aw-ol.com)"),a(n)])]),e("p",null,[e("a",_,[t("在linux系统中通过fw_printenv查看和设置u-boot中的环境变量-CSDN博客"),a(n)])])])}const g=i(s,[["render",v],["__file","fw_printfenv使用.html.vue"]]),b=JSON.parse('{"path":"/work/goke/fw_printfenv%E4%BD%BF%E7%94%A8.html","title":"fw_printfenv 使用","lang":"zh-CN","frontmatter":{},"headers":[{"level":2,"title":"一、编译","slug":"一、编译","link":"#一、编译","children":[]},{"level":2,"title":"二、内核配置","slug":"二、内核配置","link":"#二、内核配置","children":[]},{"level":2,"title":"三、修改配置文件","slug":"三、修改配置文件","link":"#三、修改配置文件","children":[]},{"level":2,"title":"四、使用","slug":"四、使用","link":"#四、使用","children":[]},{"level":2,"title":"五、通过代码使用","slug":"五、通过代码使用","link":"#五、通过代码使用","children":[]},{"level":2,"title":"六、常见问题","slug":"六、常见问题","link":"#六、常见问题","children":[]},{"level":2,"title":"七、参考链接","slug":"七、参考链接","link":"#七、参考链接","children":[]}],"git":{"updatedTime":1713184188000,"contributors":[{"name":"huangmingle","email":"huangmingle@goke.com","commits":1}]},"filePathRelative":"work/goke/fw_printfenv使用.md"}');export{g as comp,b as data};
